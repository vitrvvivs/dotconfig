#!/usr/bin/env python
# scans through connected monitors' edid to find their names
from pathlib import Path

def find_name(edid: bytes) -> str:
    # https://en.wikipedia.org/wiki/Extended_Display_Identification_Data#Display_Descriptors
    offsets = [54, 72, 90, 108]
    name_code  = 0xFC

    for offset in offsets:
        if edid[offset + 3] == name_code:
            return edid[offset + 5:offset + 18].decode('ascii').strip()
    return "unknown"

def all_names():
    sysdir = Path("/sys/class/drm/")
    for port in sysdir.iterdir():
        if not port.is_dir() or not (port / "edid").is_file(): continue
        edid = (port / "edid").read_bytes()
        if edid:
            yield find_name(edid)
            continue

if __name__ == '__main__':
    print(','.join(all_names()))
